\documentclass[a4paper,UKenglish]{article}
\usepackage[letterpaper, margin=1in]{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{authblk}
\usepackage{pict2e}
\usepackage[mathscr]{euscript}
\usepackage{tikz-cd}
\tikzset{%
	symbol/.style={%
		draw=none,
		every to/.append style={%
			edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
	}
}
\newtheorem{theorem}{Theorem}
\newtheorem{proof}{Proof}

\newcommand{\Th}{\mathrm{Th}}
\newcommand{\Gph}{\mathrm{Gph}}
\newcommand{\Set}{\mathrm{Set}}
\newcommand{\Top}{\mathrm{Top}}
\newcommand{\Grp}{\mathrm{Grp}}
\newcommand{\Cat}{\mathrm{Cat}}
\newcommand{\Mod}{\mathrm{Mod}}
\newcommand{\Pos}{\mathrm{Pos}}
\newcommand{\Mon}{\mathrm{Mon}}
\newcommand{\FinSet}{\mathrm{FinSet}}

\newcommand{\op}{\mathrm{op}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\pic}{$\pi$-calculus}
\newcommand{\V}{\mathscr{V}}
\newcommand{\W}{\mathscr{W}}
\newcommand{\C}{\mathscr{C}}
\newcommand{\D}{\mathscr{D}}
\newcommand{\T}{\mathscr{T}}
\newcommand{\Kl}{\mathscr{Kl}}
\newcommand{\pfk}{\pitchfork}

\begin{document}

\title{Enriched Lawvere Theories Represent Operational Semantics}
\author{John C. Baez and Christian Williams\\University of California, Riverside}

\maketitle

\section{Introduction}

Historically, formal structures have been defined without intrinsic connection to how they actually \textit{operate} in practical computation. In these systems, the \textit{program} is represented separately from the \textit{data} - but the disparity between \textit{thought} and \textit{action} is the source of failure. We now have a wealth of concepts which can unify the dual aspects of computation in ``dynamic'' structures. The idea is to \textit{reify} operational semantics via \textit{enrichment}.

A \textbf{Lawvere theory} \cite{lawvere} defines an algebraic structure abstractly, as a category $\T$ generated by powers of a single object $S$ and morphisms $S^n \to S$ representing $n$-ary operations, satisfying equations. This represents the \textit{theory} of a kind of algebra, which can be modelled in a category $\C$ by a power-preserving functor $\mu:\T \to \C$. This is a very general notion of ``algebra'' - computational formalisms are also presented by generators and relations: in particular, a \textbf{term calculus} represents a \textit{formal language} by sorts, term constructors, and congruence rules.

To also represent the actual \textit{process} of computation, we need the higher-level notion of \textbf{rewriting} one term into another. For this, ordinary categories are not enough - given two objects in the theory, the ``thing'' of term morphisms between them must have more structure than a set. This has been studied in the case of categories by Seely \cite{seely}, posets by Ghani and L\"uth \cite{ghani}, and others, for various related purposes. We use \textit{edges} to represent \textit{individual} rewrites: for this we use \textbf{graph-enriched Lawvere theories}:

\[\begin{array}{rl}
\text{sorts} & \text{: generating object } S\\
\text{term constructors} & \text{: generating morphisms } S^n \to S\\
\text{structural congruence} & \text{: commuting diagrams}\\
\text{\textasteriskcentered \quad rewrite rules} & \text{: generating hom-edges\quad\textasteriskcentered}\\
\end{array}\]

Plotkin's \textbf{operational semantics} \cite{sos} models rewriting systems with directed graphs, and this is the primary example; but there are many other useful enriching categories. Better yet, there are functors between them that allow the seamless \textit{transition} between different kinds of operational semantics. There is a spectrum of enriching categories which forms a gradient of resolution for the semantics of term calculi. For an enriching category $\V$, a $\V$-theory is a $\V$-enriched Lawvere theory:\\\\
\textbf{Graphs} $\Gph$-theories represent ``small-step" operational semantics\\ - a hom-graph edge represents a \textit{single} term rewrite.\\
\textbf{Categories}: $\Cat$-theories represent ``big-step" operational semantics:\\ - identity and composition represent the \textit{reflexive-transitive} closure of the rewrite relation.\\
\textbf{Posets}: $\Pos$-theories represent ``full-step" operational semantics:\\ - a hom-poset boolean represents the \textit{existence} of a big-step rewrite.\\
\textbf{Sets}: $\Set$-theories represent denotational semantics:\\ - a hom-set element represents an \textit{equivalence class} of the symmetric closure of the big-step relation.\\\\
Operational semantics is modelled and unified by enriched Lawvere theories and canonical functors between the enriching categories. This provides a more systematic categorical representation of computation.

\section{Lawvere Theories}
The ``theory of monoids'' can be defined without any reference to sets:
\[\begin{array}{rl}
\text{an object} & M\\
\text{an identity element} & e:1 \to M\\
\text{and multiplication} & m: M^2 \to M\\
\text{with associativity} & m \circ (m \times M) = m \circ (M \times m)\\
\text{and unitality} & e \circ M = M = M \circ e\\
\end{array}\]

Lawvere theories formalize this idea. They were originally called a \textit{finite product} theories: the category of finite sets $\NN$ is the free category with finite coproducts on $1$ - every finite set is (isomorphic to) the disjoint union of copies of $\{*\}$, and the opposite fact is that $\NN^\op$ is the free category with finite products on $1$; so for a category with finite products $\T$, a strictly product-preserving bijective-on-objects functor $\iota:\NN^\op \to \T$ is essentially a category generated by one object $\iota(1) = M$ and $n$-ary operations $M^n \to M$, as well as the projection and diagonal morphisms of finite products.

The abstraction of this definition is powerful: the syntax encapsulates the algebraic theory, \textit{independent} of semantics, and then one is free to realize $M$ as almost any mathematical object. For another category with finite products $\C$, a \textbf{model} of the Lawvere theory in $\C$ is a product-preserving functor $\mu: \T \to \C$. By the ``free'' property above, this functor is determined by $\mu(\iota(1)) = \mu(M) = X \in \C$. The general theory can be thereby modelled in many useful ways. For example, ordinary groups are models $\T_\Grp \to \Set$, but the theory can also be modelled in the category of topological spaces to form topological groups. The models of $\T$ in $\C$ form a category $[\T,\C]_{fp}$, in which the morphisms are natural transformations. 

Lawvere theories and finitary monads provide complementary representations of algebraic structures and computation \cite{ltam}, and they have been proven equivalent \cite{linton}. For a Lawvere theory, there is an adjunction between the category of models and the modelling category, which forms a monad on the latter; for a finitary monad, the embedding into its Kleisli category is a Lawvere theory; and these two correspondences form an equivalence of categories. The former direction is briefly reviewed to clarify the generalization to enrichment. One motivation is to use monads in an algorithm to generate sound type systems \cite{ladl}.

Let $\iota: \NN^\op \to \T$ be a Lawvere theory and $\Mod = [\T,\Set]_{fp}$ be the category of models. There is the \textbf{underlying set} functor $U:\Mod \to \Set$ which sends each model $\mu: \T \to \Set$ to the image of the generating object, $\mu(\iota(1)) = X$ in $\Set$. There is the \textbf{free model} functor $F:\Set \to \Mod$ which sends each finite set $n$ to the representable $\T(n,-):\T \to \Set$, and in general a set $X$ to the set of all $n$-ary operations on it: $\{f(x_1,...,x_n)|f\in \T(n,1), x_i\in X\}$ - this is the \textit{filtered colimit} of representables indexed by the poset of finite subsets of $X$ \cite{nlab}, which pertains to conditions of finitude in section 3. These form the adjunction: $$\Mod(F(n),\mu) \cong \mu(n) \cong \Set(n,U(\mu))$$ The left isomorphism is by the Yoneda lemma, and the right isomorphism is by the definition of power in $\Set$. Essentially, these are opposite ways of representing the $n$-ary operations of a given model. This adjunction induces a monad $T$ on $\Set$, which sends each set $X$ to the set of all terms in the theory on $X$ up to equality - the integral symbol is a \textit{coend}, essentially a coproduct quotiented by terms which are equal in the theory: $$T(X) = \int^{n\in \NN} \Th(n,1) \times X^n$$

Conversely, for a monad $T$ on $\Set$, its \textit{Kleisli category} is the category of all \textit{free algebras} of the monad. There is a ``comparison'' functor $\Set \to \Kl(T)$ which is the identity on objects and preserves products, so restricting to the subcategory of finite sets $\NN$ forms the canonical Lawvere theory corresponding to the monad. This restriction is what limits the equivalence to \textit{finitary} monads. There is a good explanation of all this in Milewski's categorical computation blog \cite{milew}. This generalizes to arbitrary \textit{locally finitely presentable} modelling categories $\C$, which we will discuss in the next section.

The correspondence of Lawvere theories and finitary monads forms an equivalence of categories $Law \cong Mnd_f$, as well as an equivalence between the \textit{models} of a theory and the \textit{algebras} of the corresponding monad. The aforementioned references suffice; we do not need further details. 

\section{Enrichment}

Let $(\V,\otimes,I)$ be a monoidal category. \cite{maclane} A \textbf{$\V$-category} $\C$ is:
\[\begin{array}{rl}
\text{a collection of objects} & Obj(\C)\\
\text{a hom-object function} & \C(-,-):Obj(\C) \times Obj(\C) \to Obj(\V)\\
\text{composition morphisms} & \circ_{a,b,c}:\C(b,c) \otimes \C(a,b) \to \C(a,c) \quad \forall a,b,c \in Obj(\C)\\
\text{identity elements} & i_a:I\to\C(a,a) \quad \forall a \in Obj(\C)\\
\end{array}\]
such that composition is associative and unital. A \textbf{$\V$-functor} $F:\C \to \D$ is:
\[\begin{array}{rl}
\text{object function} & F: Obj(\C) \to Obj(\D)\\
\text{hom-functions} & F_{ab}: \C(a,b) \to \D(Fa,Fb) \quad \forall a,b \in \C\\
\end{array}\]
such that $F$ is compatible with composition and identity. A \textbf{$\V$-natural transformation} $\alpha: F \Rightarrow G$ is:
\[\begin{array}{rl}
\text{a family} & \alpha_a: I \to \D(Fa,Ga) \quad \forall a \in Obj(\C)\\
\end{array}\]
such that $\alpha$ is ``natural'' in $a$. See \cite{enrich} for reference.

Let $\V$ be closed symmetric monoidal, providing
\[\begin{array}{rl}
\text{internal hom} & [-,-]:\V^\op\otimes \V \to \V\\
\text{symmetry braiding} & \tau_{a,b}:a\otimes b\cong b\otimes a \quad \forall a,b \in Obj(\C)\\
\text{tensor-hom adjunction} & \V(a\otimes b,c) \cong \V(a,[b,c]) \quad \forall a,b,c \in Obj(\V)\\
\end{array}\]
Then $\V$ is itself a $\V$-category, with internal hom as the hom-object function. The tensor-hom adjunction is very important: the counit $\varepsilon_{ab}: [a,b]\otimes a \to b$ is \textit{evaluation}, in the fundamental sense. This adjunction generalizes to an \textit{action} of $\V$ on any $\V$-category $\C$: for $x \in Obj(\V)$ and $a,b \in Obj(\C)$, the \textbf{power} of $b$ by $x$ and the \textbf{copower} of $a$ by $x$ are objects of $\C$ which represent the adjunction:
$$\C(a\odot x,b) \cong \V(x, \C(a,b)) \cong \C(a,x\pfk b)$$
and $\C$ is $\V$-powered or copowered if all powers or copowers exist.

These are the two basic forms of enriched limit and colimit, which are not especially intuitive; but they are a direct generalization of a familiar idea in the category of sets. In $\Set$, the power is the ``exponential'' function set and the copower is the product. To generalize this to an action on other $\Set$-categories, it is key to notice: $$X \pfk Y = X^Y \cong \prod_{y\in Y}X$$ $$X \odot Y = X \times Y \cong \coprod_{y\in Y}X$$ Then categories are canonically $\Set$-powered or copowered by indexed products or coproducts of copies of an object, provided that these exist. So in the definition of Lawvere theory, even though it seems to be all about products, it is actually about powers, because these constitute the \textit{arities} of the operations. This is precisely what is generalized in the enriched form.

There are just a few more technicalities. Given a $\V$-category $\C$, one often considers the Yoneda embedding into the $\V$-presheaf category $[\C^\op, \V]$, and it is important if certain subcategories are representable; generally, some properties of $\C$ depend on a condition of ``finitude.'' \cite{finite} A category is \textbf{locally finitely presentable} if it is the category of models for a \textit{sketch}, which is a generalization of Lawvere theory to finite limits, and an object is finitely presentable or \textbf{finite} if its representable functor is \textit{finitary}, or preserves filtered colimits. A $\V$-category $\C$ is locally finitely presentable if the underlying category $\C_0$ is LFP, $\C$ has finite powers, and $x\pfk -: \C_0 \to \C_0$ is finitary. The details are not crucial - all categories to be considered are locally finitely presentable. Interestingly, the category of finite sets is not. Denote by $\V_f$ the subcategory of $\V$ of finite objects - in $\Gph$, these are simply graphs with finite vertices and edges.\\

\section{$\V$-theories}


We propose a general framework in which one can \textit{transition} seamlessly between the various forms of operational semantics. This can be done by transitioning between enriching categories by a \textbf{monoidal functor} - a functor $F: (\V,\otimes_\V,I) \to (\W,\otimes_\W,J)$ which transfers the tensor and unit via the \textit{laxor} $\lambda: F(a) \otimes_\W F(b) \to F(a\otimes_\V b)$ and the \textit{unitor} $\upsilon: J \to F(I)$. This induces a \textbf{change of base} functor $\varphi$ (Borceux) - defining the $\W$-category $\widetilde{\varphi}(\C)$:

\[\begin{array}{rl}
\text{objects} & Obj(\C)\\
\text{hom-function} & F \circ \C(-,-):Obj(\C) \times Obj(\C) \to Obj(\V) \to Obj(\W)\\
\text{composition} & F(\circ_{a,b,c}) \circ \lambda:F(\C(b,c)) \otimes F(\C(a,b)) \to F(\C(b,c) \otimes \C(a,b)) \to F(\C(a,c)) \quad \forall a,b,c \in Obj(\C)\\
\text{identity} & F(i_a) \circ \upsilon: J \to F(I) \to F(\C(a,a)) \quad \forall a \in Obj(\C)\\
\end{array}\]

These rather abstract notions are necessary to define the central concept: a $\V$-enriched Lawvere theory, or \textbf{$\V$-theory}, is a finitely-powered $\V$-category $\Th$ equipped with a strictly power-preserving bijective-on-objects $\V$-functor $\iota:\V_f^\op \to \Th$. A \textbf{model} of a $\V$-theory is a finite-power $\V$-functor $\mu:\Th \to \V$, and $\V$-natural transformations between them form the $\V$-category of models $FP(\Th,\V)$.

This generalizes to enriched categories: $\V$-theories are equivalent to finitary $\V$-monads \cite{power}. The basic idea is the same, but there are subtleties.

\section{Semantics}
\[
\begin{tikzcd}
\Gph\arrow[r,bend left,"F_C",""{name=A, below}] & \Cat\arrow[l,bend left,"U_G",""{name=B,above}] \arrow[from=A, to=B, symbol=\dashv] \arrow[r,bend left,"F_P",""{name=C, below}] & \Pos \arrow[l,bend left,"U_C",""{name=D,above}] \arrow[r,bend left,"U_S",""{name=E, below}] \arrow[from=C, to=D, symbol=\dashv] & \Set \arrow[l,bend left,"F_P",""{name=F,above}] \arrow[from=F, to=E, symbol=\dashv]
\end{tikzcd}
\]

\bibliographystyle{amsplain}
\bibliography{lawvere}

\end{document}